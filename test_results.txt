============================= test session starts =============================
platform win32 -- Python 3.13.9, pytest-9.0.1, pluggy-1.6.0
rootdir: D:\CodeBackground\huggingface-lifecycle
configfile: pyproject.toml
plugins: cov-7.0.0, xdist-3.8.0
collected 81 items

tests\test_auth.py .........                                             [ 11%]
tests\test_checkpoint.py ...............                                 [ 29%]
tests\test_checkpoint_hub.py ..F                                         [ 33%]
tests\test_dataset.py ...FF.F.                                           [ 43%]
tests\test_model_registry.py ....FFF                                     [ 51%]
tests\test_repo.py ........                                              [ 61%]
tests\test_retention.py ...........                                      [ 75%]
tests\test_training_state.py FF....FF.                                   [ 86%]
tests\test_utils.py ..........                                           [ 98%]
tests\test_version.py .                                                  [100%]

================================== FAILURES ===================================
E   AttributeError: <module 'hf_lifecycle.checkpoint' from 'D:\\CodeBackground\\huggingface-lifecycle\\src\\hf_lifecycle\\checkpoint.py'> does not have the attribute 'snapshot_download'
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1467: AttributeError: <module 'hf_lifecycle.checkpoint' from 'D:\\CodeBackground\\huggingface-lifecycle\\src\\hf_lifecycle\\checkpoint.py'> does not have the attribute 'snapshot_download'
E   ImportError: Unable to find a usable engine; tried using: 'pyarrow', 'fastparquet'.
    A suitable version of pyarrow or fastparquet is required for parquet support.
    Trying to import the above resulted in these errors:
     - Missing optional dependency 'pyarrow'. pyarrow is required for parquet support. Use pip or conda to install pyarrow.
     - Missing optional dependency 'fastparquet'. fastparquet is required for parquet support. Use pip or conda to install fastparquet.

During handling of the above exception, another exception occurred:
E   hf_lifecycle.exceptions.DatasetError: Failed to upload DataFrame to user/dataset: Unable to find a usable engine; tried using: 'pyarrow', 'fastparquet'.
    A suitable version of pyarrow or fastparquet is required for parquet support.
    Trying to import the above resulted in these errors:
     - Missing optional dependency 'pyarrow'. pyarrow is required for parquet support. Use pip or conda to install pyarrow.
     - Missing optional dependency 'fastparquet'. fastparquet is required for parquet support. Use pip or conda to install fastparquet.
D:\CodeBackground\huggingface-lifecycle\src\hf_lifecycle\dataset.py:169: hf_lifecycle.exceptions.DatasetError: Failed to upload DataFrame to user/dataset: Unable to find a usable engine; tried using: 'pyarrow', 'fastparquet'.
E   OSError: Cannot save file into a non-existent directory: '\tmp'

During handling of the above exception, another exception occurred:
E   hf_lifecycle.exceptions.DatasetError: Failed to upload DataFrame to user/dataset: Cannot save file into a non-existent directory: '\tmp'
D:\CodeBackground\huggingface-lifecycle\src\hf_lifecycle\dataset.py:169: hf_lifecycle.exceptions.DatasetError: Failed to upload DataFrame to user/dataset: Cannot save file into a non-existent directory: '\tmp'
E   AttributeError: <module 'hf_lifecycle.dataset' from 'D:\\CodeBackground\\huggingface-lifecycle\\src\\hf_lifecycle\\dataset.py'> does not have the attribute 'snapshot_download'
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1467: AttributeError: <module 'hf_lifecycle.dataset' from 'D:\\CodeBackground\\huggingface-lifecycle\\src\\hf_lifecycle\\dataset.py'> does not have the attribute 'snapshot_download'
E   AttributeError: module 'hf_lifecycle.model_registry' has no attribute 'shutil'
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\pkgutil.py:528: AttributeError: module 'hf_lifecycle.model_registry' has no attribute 'shutil'
E   AttributeError: module 'hf_lifecycle.model_registry' has no attribute 'shutil'
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\pkgutil.py:528: AttributeError: module 'hf_lifecycle.model_registry' has no attribute 'shutil'
E   AttributeError: <module 'hf_lifecycle.model_registry' from 'D:\\CodeBackground\\huggingface-lifecycle\\src\\hf_lifecycle\\model_registry.py'> does not have the attribute 'AutoModel'
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1467: AttributeError: <module 'hf_lifecycle.model_registry' from 'D:\\CodeBackground\\huggingface-lifecycle\\src\\hf_lifecycle\\model_registry.py'> does not have the attribute 'AutoModel'
E   _pickle.UnpicklingError: Weights only load failed. This file can still be loaded, to do so you have two options, [1mdo those steps only if you trust the source of the checkpoint[0m. 
    	(1) In PyTorch 2.6, we changed the default value of the `weights_only` argument in `torch.load` from `False` to `True`. Re-running `torch.load` with `weights_only` set to `False` will likely succeed, but it can result in arbitrary code execution. Do it only if you got the file from a trusted source.
    	(2) Alternatively, to load with `weights_only=True` please check the recommended steps in the following error message.
    	WeightsUnpickler error: Unsupported global: GLOBAL numpy._core.multiarray._reconstruct was not an allowed global by default. Please use `torch.serialization.add_safe_globals([numpy._core.multiarray._reconstruct])` or the `torch.serialization.safe_globals([numpy._core.multiarray._reconstruct])` context manager to allowlist this global if you trust this class/function.
    
    Check the documentation of torch.load to learn more about types accepted by default with weights_only https://pytorch.org/docs/stable/generated/torch.load.html.
D:\CodeBackground\huggingface-lifecycle\venv\Lib\site-packages\torch\serialization.py:1529: _pickle.UnpicklingError: Weights only load failed. This file can still be loaded, to do so you have two options, [1mdo those steps only if you trust the source of the checkpoint[0m.
E   _pickle.UnpicklingError: Weights only load failed. This file can still be loaded, to do so you have two options, [1mdo those steps only if you trust the source of the checkpoint[0m. 
    	(1) In PyTorch 2.6, we changed the default value of the `weights_only` argument in `torch.load` from `False` to `True`. Re-running `torch.load` with `weights_only` set to `False` will likely succeed, but it can result in arbitrary code execution. Do it only if you got the file from a trusted source.
    	(2) Alternatively, to load with `weights_only=True` please check the recommended steps in the following error message.
    	WeightsUnpickler error: Unsupported global: GLOBAL numpy._core.multiarray._reconstruct was not an allowed global by default. Please use `torch.serialization.add_safe_globals([numpy._core.multiarray._reconstruct])` or the `torch.serialization.safe_globals([numpy._core.multiarray._reconstruct])` context manager to allowlist this global if you trust this class/function.
    
    Check the documentation of torch.load to learn more about types accepted by default with weights_only https://pytorch.org/docs/stable/generated/torch.load.html.
D:\CodeBackground\huggingface-lifecycle\venv\Lib\site-packages\torch\serialization.py:1529: _pickle.UnpicklingError: Weights only load failed. This file can still be loaded, to do so you have two options, [1mdo those steps only if you trust the source of the checkpoint[0m.
E   assert True is False
     +  where True = step(1.1)
     +    where step = <hf_lifecycle.training_state.EarlyStopping object at 0x0000018C8D102210>.step
D:\CodeBackground\huggingface-lifecycle\tests\test_training_state.py:112: assert True is False
E   assert True is False
     +  where True = step(0.4)
     +    where step = <hf_lifecycle.training_state.EarlyStopping object at 0x0000018C8D1020D0>.step
D:\CodeBackground\huggingface-lifecycle\tests\test_training_state.py:122: assert True is False
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.9-final-0 _______________

Name                                 Stmts   Miss  Cover   Missing
------------------------------------------------------------------
src\hf_lifecycle\__init__.py             1      0   100%
src\hf_lifecycle\auth.py                58     11    81%   61-62, 73-76, 103, 111-112, 144-145
src\hf_lifecycle\checkpoint.py         153     41    73%   84-88, 127-128, 170-171, 179-180, 243-244, 265, 269, 278-279, 308-309, 359-363, 367-368, 390-419
src\hf_lifecycle\dataset.py             62     18    71%   59-60, 90-91, 121-122, 156, 160-167, 193-206, 221-222
src\hf_lifecycle\exceptions.py          20      0   100%
src\hf_lifecycle\logger.py              34     34     0%   4-87
src\hf_lifecycle\model_registry.py     114     56    51%   72, 127-129, 172-240, 264-276, 295-313
src\hf_lifecycle\repo.py                66     15    77%   55, 83, 88-89, 110-111, 124, 135-136, 149, 158-159, 190-192
src\hf_lifecycle\retention.py           55      2    96%   28, 91
src\hf_lifecycle\training_state.py      77     13    83%   56-57, 78-93
src\hf_lifecycle\utils.py               89      7    92%   82, 154-155, 174, 232-234
------------------------------------------------------------------
TOTAL                                  729    197    73%
=========================== short test summary info ===========================
FAILED tests/test_checkpoint_hub.py::TestCheckpointHubSync::test_download_from_hub
FAILED tests/test_dataset.py::TestDatasetManager::test_upload_dataframe_parquet
FAILED tests/test_dataset.py::TestDatasetManager::test_upload_dataframe_csv
FAILED tests/test_dataset.py::TestDatasetManager::test_download_dataset - Att...
FAILED tests/test_model_registry.py::TestModelRegistry::test_register_model
FAILED tests/test_model_registry.py::TestModelRegistry::test_register_model_with_metrics
FAILED tests/test_model_registry.py::TestModelRegistry::test_load_model - Att...
FAILED tests/test_training_state.py::TestTrainingStateManager::test_save_and_load_state
FAILED tests/test_training_state.py::TestTrainingStateManager::test_rng_restoration
FAILED tests/test_training_state.py::TestEarlyStopping::test_early_stopping_improvement
FAILED tests/test_training_state.py::TestEarlyStopping::test_early_stopping_max_mode
======================= 11 failed, 70 passed in 16.42s ========================
D:\CodeBackground\huggingface-lifecycle\venv\Lib\site-packages\_pytest\pathlib.py:96: PytestWarning: (rm_rf) error removing \\?\C:\Users\Dark_Coder\AppData\Local\Temp\pytest-of-Dark_Coder\garbage-8d7a3aa0-03cb-43a2-a5b1-f96f69507a2c
<class 'OSError'>: [WinError 145] The directory is not empty: '\\\\?\\C:\\Users\\Dark_Coder\\AppData\\Local\\Temp\\pytest-of-Dark_Coder\\garbage-8d7a3aa0-03cb-43a2-a5b1-f96f69507a2c'
  warnings.warn(
D:\CodeBackground\huggingface-lifecycle\venv\Lib\site-packages\_pytest\pathlib.py:96: PytestWarning: (rm_rf) error removing \\?\C:\Users\Dark_Coder\AppData\Local\Temp\pytest-of-Dark_Coder\garbage-4e3c0b11-7a86-4dc2-a3ee-aadfe2e964d0
<class 'OSError'>: [WinError 145] The directory is not empty: '\\\\?\\C:\\Users\\Dark_Coder\\AppData\\Local\\Temp\\pytest-of-Dark_Coder\\garbage-4e3c0b11-7a86-4dc2-a3ee-aadfe2e964d0'
  warnings.warn(
D:\CodeBackground\huggingface-lifecycle\venv\Lib\site-packages\_pytest\pathlib.py:96: PytestWarning: (rm_rf) error removing \\?\C:\Users\Dark_Coder\AppData\Local\Temp\pytest-of-Dark_Coder\garbage-ac5b737a-3c95-43b9-9547-1f0fbd4cc76b
<class 'OSError'>: [WinError 145] The directory is not empty: '\\\\?\\C:\\Users\\Dark_Coder\\AppData\\Local\\Temp\\pytest-of-Dark_Coder\\garbage-ac5b737a-3c95-43b9-9547-1f0fbd4cc76b'
  warnings.warn(
